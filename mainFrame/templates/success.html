{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>YummiLicious</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />

        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="{% static 'css/success.css' %}">

        <link rel="icon" href="{% static 'images/mainLogo.png' %}">
        <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script> -->
        <!-- <script src="https://cdn.maptiler.com/maptiler-sdk-js/v1.1.1/maptiler-sdk.umd.js"></script>
        <link href="https://cdn.maptiler.com/maptiler-sdk-js/v1.1.1/maptiler-sdk.css" rel="stylesheet" />
        <script src="https://cdn.maptiler.com/leaflet-maptilersdk/v1.0.0/leaflet-maptilersdk.js"></script> -->


        <!-- map -->
        <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      />
      <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"
      />


        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script> <!-- new -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> <!-- new -->
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
        <script type="text/javascript" defer src="{% static 'js/success.js' %}"></script>
    </head>
    <body style="background-image: linear-gradient(to bottom, #50cc7f 0%, #f5d100 100%);">
        <nav >
            <div class="logo">
                <img src="{% static 'images/CoolBrand.png' %}" height="70"  alt="CoolBrand">
            </div>
            <ul>
                <li>
                    <a href="customerLogout/{{ orderData.customer_id }}"><i class="fa-solid fa-right-from-bracket"></i></i>&ensp;Logout</a>
                </li>
        </ul>
        </nav>
        <div class="pb-5">
            <section class="vh-100" >
                <div class="container py-5 h-100">
                    <div class="row d-flex justify-content-center align-items-center h-100">
                        <div class="col-12">
                            <div class="card card-stepper text-black" style="border-radius: 16px;">
              
                                <div class="card-body p-5">
              
                                    <div class="d-flex justify-content-between align-items-center mb-5">
                                        <div>
                                            <h5 class="mb-0">ORDER ID <span class="font-weight-bold" style="color: #85cd56;">{{ orderData.orderNumber }}</span></h5>
                                        </div>
                                        <!-- <div class="text-end">
                                        <p class="mb-0">Expected Arrival <span>01/12/19</span></p>
                                        <p class="mb-0">USPS <span class="font-weight-bold">234094567242423422898</span></p>
                                        </div> -->
                                    </div>
                                    {% if orderData.orderMode == 'delivery' %}
                                        <ul id="progressbar-2" class="d-flex tocheck justify-content-between mx-0 mt-0 mb-5 px-0 pt-0 pb-2" data-orderstatus="{{ orderData.orderStatus }}" data-ordermode="{{ orderData.orderMode }}">
                                            <li class="step0 text-center"  id="step1"></li>
                                            <li class="step0 text-center" id="step2"></li>
                                            <li class="step0 text-center" id="step3"></li>
                                            <li class="step0 text-center" id="step4"></li>
                                            <li class="step0 text-muted text-end" id="step5"></li>
                                        </ul>
                
                                        <div class="d-flex justify-content-between ">
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fas fa-clipboard-list fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">Placed</p>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fas fa-check-circle fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">Accepted</p>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fas fa-utensils fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">In Kitchen</p>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fa-solid fa-motorcycle fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">En Route</p>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fas fa-home fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">Delivered</p>
                                                </div>
                                            </div>
                                        </div>
                                    {% else %}
                                        <ul id="progressbar-2" class="d-flex tocheck justify-content-between mx-0 mt-0 mb-5 px-0 pt-0 pb-2" data-orderstatus="{{ orderData.orderStatus }}" data-ordermode="{{ orderData.orderMode }}">
                                            <li class="step0 text-center"  id="step1"></li>
                                            <li class="step0 text-center" id="step2"></li>
                                            <li class="step0 text-center" id="step3"></li>
                                            <li class="step0 text-center" id="step4"></li>
                                            <li class="step0 text-muted text-end" id="step5"></li>
                                        </ul>

                                        <div class="d-flex justify-content-between ">
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fas fa-clipboard-list fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">Placed</p>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fas fa-check-circle fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">Accepted</p>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fas fa-utensils fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">In Kitchen</p>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fa-solid fa-person-walking fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">Ready</p>
                                                </div>
                                            </div>
                                            <div class="d-lg-flex align-items-center">
                                                <i class="fas fa-person-circle-check fa-3x me-lg-4 mb-3 mb-lg-0"></i>
                                                <div>
                                                    <p class="fw-bold mb-1">Order</p>
                                                    <p class="fw-bold mb-0">Collected</p>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                    <div style="margin-top: 70px;">
                                        <p class="mt-4 pt-2 mb-0" >Want any help? 
                                            <a href="#" style="color: #85cd56;" id="mailModalCard" data-bs-toggle="modal" data-bs-target="#mailModal">Please contact us </a>
                                        </p>
                                    </div>
                                </div>
                                {% if orderData.orderStatus == 'en_route' %}
                                    <div id="map" style="width: 100%; height: 400px;" data-restaurantPostCode="{{ orderData.restaurantInfo.postcode }}" data-customerPostCode="{{ orderData.customerAddress.postcode }}"></div>
                                    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
                                    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
                                    <!-- <script>
                                        const key = 'yhkLR52ToG5Hk6numPAn';
                                        const map = L.map('map').setView([51.5074, -0.1278], 13); 
                                        const mtLayer = L.maptilerLayer({
                                            apiKey: key,
                                            style: L.MaptilerStyle.STREETS, 
                                            center: [51.5074, -0.1278],
                                        }).addTo(map);
                                        L.marker([51.5074, -0.1278]).addTo(map)
                                            .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
                                            .openPopup();
                                    </script> -->

                                    <script>
                                        var map = L.map('map').setView([0, 0], 6);
                        
                                        chekStart = document.getElementById("map").getAttribute("data-restaurantPostCode");
                                        checkEnd = document.getElementById("map").getAttribute("data-customerPostCode");

                                        L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=yhkLR52ToG5Hk6numPAn', {
                                            maxZoom: 18,
                                        }).addTo(map);

                                        var routingControl;

                                        Promise.all([
                                            fetch('https://nominatim.openstreetmap.org/search?format=json&q=' + chekStart).then(response => response.json()),
                                            fetch('https://nominatim.openstreetmap.org/search?format=json&q=' + checkEnd).then(response => response.json())
                                        ])
                                        .then(data => {
                                            var startLat = parseFloat(data[0][0].lat);
                                            var startLon = parseFloat(data[0][0].lon);
                                            var endLat = parseFloat(data[1][0].lat);
                                            var endLon = parseFloat(data[1][0].lon);

                                            var startPoint = L.latLng(startLat, startLon);
                                            var endPoint = L.latLng(endLat, endLon);

                                            if (routingControl) {
                                                map.removeControl(routingControl);
                                            }

                                            routingControl = L.Routing.control({
                                                waypoints: [
                                                    startPoint,
                                                    endPoint
                                                ],
                                                routeWhileDragging: false,
                                                show: false
                                            }).addTo(map);
                                            

                                            map.fitBounds([startPoint, endPoint]);
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                        });

                                      </script>


                                {% elif orderData.orderStatus == 'delivered' %}
                                <div id="ratingCard" class="rating-card d-none" data-customerid="{{ orderData.customer_id }}" data-restaurantid="{{ orderData.restaurant_id }}">
                                    <!-- {% csrf_token %} -->
                                    <p class="fw-bold mb-1" style="margin-top: 25px;"><h3>How was your food?</h3></p>
                                    <div class="emoji-rating">
                                        <div class="emoji" data-rating="1">üòû</div>
                                        <div class="emoji" data-rating="2">üòê</div>
                                        <div class="emoji" data-rating="3">üòä</div>
                                        <div class="emoji" data-rating="4">üòÑ</div>
                                        <div class="emoji" data-rating="5">üòç</div>
                                    </div>
                                    <div id="feedbackSection" class="feedback-section">
                                        <textarea id="feedbackTextarea" rows="3" placeholder="Leave your feedback..."></textarea>
                                        <button id="submitFeedbackBtn">Submit</button>
                                    </div>
                                </div>
                                {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              </section> 
        </div>

        <div class="modal fade" id="mailModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Mail Cover</h5>
                  {% csrf_token %}
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="max-height: 50vh; overflow-y: auto;">
                  <div class="mb-3">
                    <label for="toaddress" class="form-label">From Address</label>
                    <input type="email" class="form-control" id="toAddress">
                    <div class="invalid-feedback" id="fromAddressError">Please enter the from address</div>
                  </div>
                  <div class="mb-3">
                    <label for="subject" class="form-label">Subject</label>
                    <input type="text" class="form-control" id="mailSubject">
                    <div class="invalid-feedback" id="mailSubjectError">Please enter the subject</div>
                  </div>
                  <div class="mb-3">
                    <label for="body" class="form-label">Body</label>
                    <!-- <input type="text" class="form-control" id="mailBody"> -->
                    <textarea class="form-control" id="mailBody" rows="5"></textarea>
                    <div class="invalid-feedback" id="mailBodyError">Please enter the body</div>
                  </div>
                </div>
                <div class="modal-footer d-flex justify-content-center align-items-center flex-column">
                  <div>
                    <button class="sendMail" id="sendMailButton">Send Email</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
    </body>
</html>

